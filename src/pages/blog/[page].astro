---
import BlogCard from "@/components/Blog/BlogCard.astro";
import BlogPagination from "@/components/Blog/BlogPagination.astro";
import PaginationInfo from "@/components/Blog/PaginationInfo.astro";
import Layout from "@/layouts/Layout.astro";
import type { GetStaticPaths } from "astro";
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const allPosts = await getCollection("blog");

  // Sort posts by publication date in descending order (newest first)
  const sortedPosts = allPosts.sort(
    (a, b) =>
      new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );

  return paginate(sortedPosts, {
    pageSize: 6,
  });
};

type Props = {
  page: {
    data: CollectionEntry<"blog">[];
    currentPage: number;
    lastPage: number;
    url: {
      prev?: string;
      next?: string;
    };
    start: number;
    end: number;
    total: number;
  };
};

const { page } = Astro.props;
---

<Layout title="Blog | Deren Tanaphan">
  <section
    class="flex flex-col items-center justify-center space-y-5 lg:space-y-8 pt-28 pb-20 lg:pt-36 lg:pb-24"
  >
    <div
      class="flex flex-col items-center justify-center space-y-2 lg:space-y-3"
    >
      <h1
        class="text-3xl lg:text-4xl xl:text-5xl font-bold text-center dark:text-neutral-100 text-neutral-900"
      >
        Blog
      </h1>
      <p
        class="text-base lg:text-lg font-medium text-center dark:text-neutral-400 text-neutral-600"
      >
        My thoughts, experiences, and insights on various topics.
      </p>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4">
      {
        page.data.map((post) => (
          <BlogCard
            title={post.data.title}
            thumbnailUrl={post.data?.thumbnailUrl || ""}
            content={post.body}
            date={post.data.pubDate.toISOString()}
            slug={post.slug}
            tags={post.data.tags || []}
          />
        ))
      }
    </div>
    {
      page.lastPage > 1 && (
        <div class="flex flex-col items-center space-y-4">
          <PaginationInfo
            start={page.start + 1}
            end={page.end + 1}
            total={page.total}
          />
          <BlogPagination
            currentPage={page.currentPage}
            totalPages={page.lastPage}
            prevUrl={page.url.prev}
            nextUrl={page.url.next}
          />
        </div>
      )
    }
  </section>
</Layout>
